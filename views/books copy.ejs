<%- include('layout/header') %>


<div class="container mt-5">
  <!-- The Nav Header -->
  <ul class="nav nav-tabs">
    <li class="nav-item">
      <a class="nav-link active fs-5" data-bs-toggle="tab" href="#allBooks">All Books</a>
    </li>

    <!-- A loop for each genre Header -->
    <% genres.forEach(genre => { %>
      <li class="nav-item">
        <a class="nav-link fs-5" data-bs-toggle="tab" href="#genre<%= genre.genreId %>"><%= genre.genreName %></a>
      </li>
    <% }) %>
  </ul>


  <!-- The nave Body -->
  <div id="myTabContent" class="tab-content">
    <!-- The part of the all books -->
    <div class="tab-pane fade active show " id="allBooks">
      <div class="container mt-3">
        <div class="row">
          <div class="col-6">
            <h3 class="my-3">Books Count: <%= books.count %></h3>
          </div>

          <div class="col-auto ms-auto">
            <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link " id="pills-allBooksIconView-tab" data-bs-toggle="pill" data-bs-target="#pills-allBooksIconView" type="button" role="tab" aria-controls="pills-allBooksIconView" aria-selected="true"><i class="bi bi-grid-fill"></i></button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="pills-allBooksTableView-tab" data-bs-toggle="pill" data-bs-target="#pills-allBooksTableView" type="button" role="tab" aria-controls="pills-allBooksTableView" aria-selected="false"><i class="bi bi-list"></i></button>
              </li>
            </ul>
            
          </div>
        </div>
        <div class="tab-content" id="pills-tabContent">

          <!-- The grid view -->
          <div class="tab-pane fade show active px-5" id="pills-allBooksIconView" role="tabpanel" aria-labelledby="pills-allBooksIconView-tab">
            
            <%- include('layout/booksGridView', {books: books.rows})%>
            
          </div>



          <!-- The list view  -->
          <div class="tab-pane fade" id="pills-allBooksTableView" role="tabpanel" aria-labelledby="pills-allBooksTableView-tab">
            <table class="table display" id="booksTable">
            <!-- <table class="table table-striped table-hover table-primary"> -->
              <thead>
                <tr>
                  <th scope="col">name</th>
                  <th scope="col">author</th>
                  <th scope="col">pages</th>
                  <th scope="col">genre</th>
                  <th scope="col">book copy</th>
                  <th scope="col">loaned</th>
                  <th scope="col">did read</th>
                </tr>
              </thead>
              <tbody>
                <% books.rows.forEach(book => { %>
                  <tr>
                    <td><%= book.bookName %> </td>
                    <% if (book.Author) { %>
                      <td><%= book.Author.authorName %></td>
                    <% } else { %>
                      <td>unKnown</td>
                    <% } %>
                    <% if (book.bookPages) { %>
                      <td><%= book.bookPages %></td>
                    <% } else { %>
                      <td>unknown</td>
                    <% } %>
                    <td><%= book.Genre.genreName %> </td>
                    <td><%= book.bookCopy %> </td>
                    <% if (book.Loaner) { %>
                      <td><%= book.Loaner.loanerName %></td>
                      <% } else { %>
                        <td>NO</td>
                    <% } %>
      
                    <% if (book.didRead == 1) { %>
                      <td>YES</td>
                    <% } else { %>
                      <td>NO</td>
                    <% } %>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
        </div>
        
                

        
      </div>
    </div>
    




    <!-- A loop for each genre -->
    <% genres.forEach(genre => { %>
      <div class="tab-pane fade" id="genre<%= genre.genreId %>">
        // TODO: check if the genre has books
        <!-- The table of the genre -->
        <div class="container mt-3">
          <h3 class="my-3">Books Count: <%= genre.Books.length %> </h3>
          <table class="table">
            <thead>
              <tr>
                <th scope="col">name</th>
                <th scope="col">author</th>
                <th scope="col">pages</th>
                <th scope="col">book copy</th>
                <th scope="col">loaned</th>
                <th scope="col">did read</th>
              </tr>
            </thead>
            <tbody>
              <% genre.Books.forEach(book => { %>
                <tr>
                  <td><%= book.bookName %> </td>
                  <% if (book.Author) { %>
                    <td><%= book.Author.authorName %></td>
                  <% } else { %>
                    <td>unKnown</td>
                  <% } %>
                  <% if (book.bookPages) { %>
                    <td><%= book.bookPages %></td>
                  <% } else { %>
                    <td>unknown</td>
                  <% } %>
                  <td><%= book.bookCopy %> </td>
                  <% if (book.Loaner) { %>
                    <td><%= book.Loaner.loanerName %></td>
                    <% } else { %>
                      <td>NO</td>
                  <% } %>
    
                  <% if (book.didRead == 1) { %>
                    <td>YES</td>
                  <% } else { %>
                    <td>NO</td>
                  <% } %>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      </div>     
    <% }) %>


  </div>
</div>
<%- include('layout/footer') %>